<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment Success</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<div class="success-container">
  <div class="center-block">
    <div class="gif">
      <img src="img/emojibest_com_AnimatedSticker.gif" alt="GIF">
    </div>
    <div class="success-text">
      <h1>Оплата прошла успешно!</h1>
      <p>Спасибо за покупку. Ваш VPN теперь активен.</p>
      <button class="home-button" id="accessButton">Получить доступ</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script>
  // Функция для запуска конфетти
  function launchConfetti() {
    var duration = 2 * 1000;
    var end = Date.now() + duration;

    (function frame() {
      confetti({
        particleCount: 3,
        angle: 60,
        spread: 55,
        origin: { x: 0 }
      });
      confetti({
        particleCount: 3,
        angle: 120,
        spread: 55,
        origin: { x: 1 }
      });

      if (Date.now() < end) {
        requestAnimationFrame(frame);
      }
    }());
  }

  // Запуск конфетти при загрузке страницы
  window.onload = function() {
    launchConfetti();
    
    // Получение данных из локального хранилища
    const userId = localStorage.getItem('user_id');
    const selectedServer = localStorage.getItem('selectedServer');
    const selectedPlan = localStorage.getItem('selectedPlan');
    const selectedPayment = localStorage.getItem('selectedPayment');

    if (userId && selectedServer && selectedPlan && selectedPayment) {
      const vpnData = {
        userId: userId,
        selectedServer: selectedServer,
        selectedPlan: selectedPlan,
        selectedPayment: selectedPayment
      };
      console.log('Данные из локального хранилища:', vpnData);

      document.getElementById('accessButton').addEventListener('click', function() {
        console.log('Кнопка "Получить доступ" нажата');
        console.log('Отправка данных на сервер:', vpnData);
        
        // Отправка данных на сервер Flask
        fetch('http://127.0.0.1:5000/submit', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(vpnData)
        })
        .then(response => response.json())
        .then(data => {
          console.log('Ответ сервера:', data);
        })
        .catch(error => {
          console.error('Ошибка:', error);
        });
      });
    } else {
      console.error('Некоторые данные отсутствуют в локальном хранилище');
    }
  };
</script>

</body>
</html>
